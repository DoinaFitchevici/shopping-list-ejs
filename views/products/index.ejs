<%- include("../partials/head.ejs") %>
<%- include("../partials/header.ejs") %>

<h1>Product List</h1>

<% if (successMessages && successMessages.length > 0) { %>
  <div class="alert alert-success">
    <% successMessages.forEach(function (msg) { %>
      <p><%= msg %></p>
    <% }); %>
  </div>
<% } %>

<% if (errorMessages && errorMessages.length > 0) { %>
  <div class="alert alert-danger">
    <% errorMessages.forEach(function (msg) { %>
      <p><%= msg %></p>
    <% }); %>
  </div>
<% } %>

<div class="sorting-options">
  <h2>Sort By:</h2>
  <ul>
    <li><a href="/products?sort=name">Name (A-Z)</a></li>
    <li><a href="/products?sort=pricelow">Price (Low to High)</a></li>
    <li><a href="/products?sort=pricehigh">Price (High to Low)</a></li>
  </ul>
</div>


<ul class="list-group">
  <% if (products.length > 0) { %>
    <% products.forEach(product => { %>
      <li class="list-group-item">
        <div class="container">
        <div class="column">
         <span><%= product.name %></span>
            <span class="quantity">($<%= product.price %>)</span>
          </div>
        <div class="column">
            <a href="/products/edit/<%= product._id %>"><button type="submit" class="button">Edit</button></a>
            <form method="POST" action="/products/delete/<%= product._id %>" style="display: inline">
              <button type="submit" class="button">Delete</button>
              <input type="hidden" name="_csrf" value="<%= _csrf %>" />
            </form>
        </div>
        </div>
      </li>
    <% }) %>
  <% } else { %>
    <li class="list-group-item">No products found.</li>
  <% } %>
</ul>

<nav aria-label="Page navigation">
  <ul class="pagination">
    <% for(let i = 1; i <= totalPages; i++) { %>
      <li class="page-item <%= page === i ? 'active' : '' %>">
        <a class="page-link" href="?page=<%= i %>"><%= i %></a>
      </li>
    <% } %>
  </ul>
</nav>

<a href="/products/new" class="button">Add New Product</a>

<%- include("../partials/footer.ejs") %>
